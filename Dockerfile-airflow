FROM python:3.7
ENV AIRFLOW_HOME=/airflow
RUN apt update && apt install -y git
RUN mkdir /airflow/
RUN git clone -b master https://gitlab+deploy-token-170408:mGW4y9QB-x5Yqa6sPGQ5@gitlab.com/pencillabs/ej/airflow_dags.git /airflow/dags
RUN cp /airflow/dags/src/.analyticsreporting.dat /airflow
WORKDIR  /airflow/dags/src/ej
RUN cp client_secrets.json /tmp/
RUN cp .*.env /tmp
RUN pip install -r requirements.txt
RUN airflow initdb
